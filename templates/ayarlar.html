{% extends "base.html" %}

{% block title %}Ayarlar{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Başlık -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Ayarlar</h1>
        <p class="text-gray-600">Sistem yapılandırması ve geçmiş kayıtlar</p>
    </div>

    <!-- Tab Başlıkları -->
    <div class="flex space-x-1 border-b border-gray-200 mb-6 overflow-x-auto">
        <button onclick="tabDegistir('imza')" id="tab-imza"
            class="tab-btn flex items-center gap-2 px-6 py-3 border-b-2 border-indigo-500 text-indigo-600 bg-indigo-50 font-medium transition-all focus:outline-none">
            <i data-lucide="pen-tool" class="w-4 h-4"></i>
            İmza Ayarları
        </button>
        <button onclick="tabDegistir('sayac')" id="tab-sayac"
            class="tab-btn flex items-center gap-2 px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium transition-all focus:outline-none">
            <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
            Sayaç İşlemleri
        </button>
        <button onclick="tabDegistir('dosya')" id="tab-dosya"
            class="tab-btn flex items-center gap-2 px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium transition-all focus:outline-none">
            <i data-lucide="folder-open" class="w-4 h-4"></i>
            Dosya Yöneticisi
        </button>
        <button onclick="tabDegistir('tarif')" id="tab-tarif"
            class="tab-btn flex items-center gap-2 px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium transition-all focus:outline-none">
            <i data-lucide="book-open" class="w-4 h-4"></i>
            Tarifler (Geçmiş)
        </button>
        <button onclick="tabDegistir('sinavlar')" id="tab-sinavlar"
            class="tab-btn flex items-center gap-2 px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium transition-all focus:outline-none">
            <i data-lucide="award" class="w-4 h-4"></i>
            Hazırlanan Sınavlar
        </button>
        <button onclick="tabDegistir('json')" id="tab-json"
            class="tab-btn flex items-center gap-2 px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium transition-all focus:outline-none">
            <i data-lucide="code-2" class="w-4 h-4"></i>
            JSON
        </button>
    </div>

    <!-- İçerik Alanı -->
    <div>

        <!-- TAB 1: İMZA AYARLARI -->
        <div id="content-imza" class="tab-content animate-fade-in bg-white rounded-xl shadow-lg p-6">
            <form id="ayarForm" class="space-y-8">
                <!-- İmza Ayarları Bölümü -->
                <div>
                    <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-4 mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-indigo-100 text-indigo-600 rounded-lg">
                                <i data-lucide="pen-tool" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-indigo-900">İmza Görünümü</h3>
                                <p class="text-xs text-indigo-600">Sınav kağıdı altındaki imza alanını özelleştirin</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- İmza Metni -->
                        <div>
                            <label for="imzaMetni" class="block text-sm font-medium text-gray-700 mb-2">
                                İmza Metni
                            </label>
                            <input type="text" id="imzaMetni"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                                placeholder="Örn: Öğr.Gör.Erdem ALPAR"
                                value="{{ ayarlar.imza_metni if ayarlar else '' }}">
                        </div>

                        <!-- Çizgi Rengi ve Kalınlık -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="cizgiRengi" class="block text-sm font-medium text-gray-700 mb-2">
                                    Çizgi Rengi
                                </label>
                                <div class="flex items-center gap-4">
                                    <input type="color" id="cizgiRengi"
                                        class="h-10 w-full rounded-lg cursor-pointer border-2 border-gray-300 p-1"
                                        value="{{ ayarlar.cizgi_rengi if ayarlar else '#CCCCCC' }}">
                                </div>
                            </div>
                            <div>
                                <label for="cizgiKalinlik" class="block text-sm font-medium text-gray-700 mb-2">
                                    Çizgi Kalınlığı: <span id="kalinlikDeger"
                                        class="text-indigo-600 font-bold">1px</span>
                                </label>
                                <input type="range" id="cizgiKalinlik" min="1" max="5" step="0.5"
                                    class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                    value="{{ ayarlar.cizgi_kalinlik if ayarlar else '1' }}"
                                    oninput="document.getElementById('kalinlikDeger').textContent = this.value + 'px'">
                            </div>
                        </div>

                        <!-- Metin Boyutu -->
                        <div>
                            <label for="metinBoyutu" class="block text-sm font-medium text-gray-700 mb-2">
                                Metin Boyutu: <span id="boyutDeger" class="text-indigo-600 font-bold">12pt</span>
                            </label>
                            <input type="range" id="metinBoyutu" min="8" max="16" step="1"
                                class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                value="{{ ayarlar.metin_boyutu if ayarlar else '12' }}"
                                oninput="document.getElementById('boyutDeger').textContent = this.value + 'pt'">
                        </div>
                    </div>
                </div>

                <!-- Önizleme -->
                <div class="bg-gray-50 rounded-lg p-6 border-2 border-dashed border-gray-300 mt-6">
                    <p class="text-xs text-slate-400 text-center mb-4 uppercase tracking-widest">Önizleme Alanı</p>
                    <div class="max-w-md mx-auto py-4">
                        <div id="onizlemeCizgi" class="border-t mb-2" style="border-color: #CCCCCC; border-width: 1px;">
                        </div>
                        <p id="onizlemeMetin" class="text-center text-gray-600" style="font-size: 12pt;">
                            {{ ayarlar.imza_metni if ayarlar and ayarlar.imza_metni else 'Öğr.Gör.Erdem ALPAR' }}
                        </p>
                    </div>
                </div>

                <!-- Butonlar -->
                <div
                    class="flex items-center gap-4 pt-4 border-t sticky bottom-0 bg-white p-4 -mx-6 -mb-6 rounded-b-xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                    <button type="submit"
                        class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        Ayarları Kaydet
                    </button>
                    <button type="button" onclick="sifirla()"
                        class="px-6 py-3 rounded-lg font-medium border-2 border-gray-300 text-gray-700 hover:bg-gray-50 transition-all flex items-center gap-2">
                        <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                        Sıfırla
                    </button>
                </div>
            </form>
        </div>

        <!-- TAB 2: SAYAÇ İŞLEMLERİ -->
        <div id="content-sayac" class="tab-content hidden animate-fade-in bg-white rounded-xl shadow-lg p-6">
            <div class="max-w-3xl mx-auto py-4">
                <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
                    <div class="flex items-start gap-3">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-red-600 mt-0.5"></i>
                        <div>
                            <p class="text-sm font-bold text-red-800 mb-1">Önemli Uyarı</p>
                            <p class="text-sm text-red-700">
                                Sayaç sıfırlama işlemi, ilgili tablodaki ID numarasını 1'e döndürür.
                                Eğer tabloda halen veri varken bu işlemi yaparsanız, yeni kayıt eklerken "Duplicate Key"
                                (Çakışan Anahtar) hatası alabilirsiniz.
                                <br><br>
                                <strong>Öneri:</strong> Sayaçları sıfırlamadan önce "Tüm Soruları Sil" gibi temizleme
                                işlemlerini yaptığınızdan emin olun.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <!-- Soru Bankası Sayacı -->
                    <div
                        class="bg-white border border-slate-200 rounded-lg p-6 flex flex-col sm:flex-row items-center justify-between gap-4 hover:shadow-md transition-all hover:border-indigo-200">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-indigo-100 text-indigo-600 rounded-full">
                                <i data-lucide="database" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 text-lg">Soru Bankası</h3>
                                <p class="text-sm text-slate-500">Sorular tablosu (ID)</p>
                                <div
                                    class="mt-2 text-xs flex gap-3 text-slate-600 bg-slate-50 p-2 rounded border border-slate-100">
                                    <span>Toplam: <strong>{{ istatistik.soru_toplam }}</strong></span>
                                    <span class="text-slate-300">|</span>
                                    <span>Son ID: <strong>{{ istatistik.soru_sayac }}</strong></span>
                                </div>
                            </div>
                        </div>
                        <button type="button" onclick="sayacSifirla('sorular')"
                            class="w-full sm:w-auto bg-white border border-slate-300 text-slate-700 hover:bg-indigo-50 hover:text-indigo-600 hover:border-indigo-200 px-6 py-2 rounded-lg font-medium transition-all shadow-sm">
                            Sayacı Sıfırla
                        </button>
                    </div>

                    <!-- Sınav Kağıtları Sayacı -->
                    <div
                        class="bg-white border border-slate-200 rounded-lg p-6 flex flex-col sm:flex-row items-center justify-between gap-4 hover:shadow-md transition-all hover:border-indigo-200">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-purple-100 text-purple-600 rounded-full">
                                <i data-lucide="file-text" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 text-lg">Sınav Kağıtları</h3>
                                <p class="text-sm text-slate-500">Oluşturulan sınavlar tablosu (ID)</p>
                                <div
                                    class="mt-2 text-xs flex gap-3 text-slate-600 bg-slate-50 p-2 rounded border border-slate-100">
                                    <span>Toplam: <strong>{{ istatistik.sinav_toplam }}</strong></span>
                                    <span class="text-slate-300">|</span>
                                    <span>Son ID: <strong>{{ istatistik.sinav_sayac }}</strong></span>
                                </div>
                            </div>
                        </div>
                        <button type="button" onclick="sayacSifirla('sinav_kagitlari')"
                            class="w-full sm:w-auto bg-white border border-slate-300 text-slate-700 hover:bg-purple-50 hover:text-purple-600 hover:border-purple-200 px-6 py-2 rounded-lg font-medium transition-all shadow-sm">
                            Sayacı Sıfırla
                        </button>
                    </div>

                    <!-- Tümünü Sıfırla -->
                    <div class="mt-8 pt-6 border-t border-slate-100">
                        <button type="button" onclick="sayacSifirla('hepsi')"
                            class="w-full bg-red-600 hover:bg-red-700 text-white px-6 py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-3 shadow-lg hover:shadow-xl hover:scale-[1.01]">
                            <i data-lucide="trash-2" class="w-6 h-6"></i>
                            Tüm Sistem Sayaçlarını Sıfırla
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 3: DOSYA YÖNETİCİSİ -->
        <div id="content-dosya" class="tab-content hidden animate-fade-in h-[600px] bg-white rounded-xl shadow-lg p-6">
            <div class="flex h-full gap-6">
                <!-- Sol Panel: Dosya Listesi -->
                <div class="w-1/3 bg-gray-50 rounded-lg border border-gray-200 flex flex-col">
                    <div class="p-4 border-b border-gray-200 bg-gray-100 rounded-t-lg">
                        <h3 class="font-semibold text-gray-700 flex items-center gap-2">
                            <i data-lucide="files" class="w-4 h-4"></i>
                            Dosyalar ({{ dosyalar|length }})
                        </h3>
                    </div>
                    <div class="flex-1 overflow-y-auto p-2 space-y-1">
                        {% for dosya in dosyalar %}
                        <button onclick="dosyaGoster('{{ dosya.ad }}', '{{ dosya.uzanti }}')"
                            class="w-full text-left px-4 py-3 rounded-lg hover:bg-white hover:shadow-sm border border-transparent hover:border-gray-200 transition-all group flex items-center gap-3">
                            <i data-lucide="{{ 'image' if dosya.uzanti in ['png', 'jpg', 'jpeg'] else 'file-text' }}"
                                class="w-5 h-5 text-gray-400 group-hover:text-indigo-500 transition-colors"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-700 truncate">{{ dosya.ad }}</p>
                                <p class="text-xs text-gray-400">{{ dosya.boyut }} • {{ dosya.tarih }}</p>
                            </div>
                        </button>
                        {% else %}
                        <div class="p-8 text-center text-gray-400">
                            <i data-lucide="folder-x" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                            <p class="text-sm">Hiç dosya yüklenmemiş.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Sağ Panel: Önizleme -->
                <div class="w-2/3 bg-gray-900 rounded-lg border border-gray-800 flex flex-col overflow-hidden relative"
                    id="onizlemeAlani">
                    <!-- Placeholder -->
                    <div id="onizlemePlaceholder"
                        class="absolute inset-0 flex flex-col items-center justify-center text-gray-500">
                        <i data-lucide="eye" class="w-12 h-12 mb-4 opacity-20"></i>
                        <p>Dosya içeriğini görmek için listeden seçim yapın</p>
                    </div>

                    <!-- İçerik Container (Resim/Iframe) -->
                    <div id="onizlemeIcerik" class="hidden w-full h-full flex flex-col">
                        <div class="bg-gray-800 p-3 flex justify-between items-center border-b border-gray-700">
                            <span id="aktifDosyaAdi" class="text-gray-200 font-medium text-sm truncate">Dosya Adı</span>
                            <a id="indirmeLinki" href="#" target="_blank"
                                class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded transition-colors flex items-center gap-1">
                                <i data-lucide="download" class="w-3 h-3"></i> İndir
                            </a>
                        </div>
                        <div class="flex-1 overflow-auto flex items-center justify-center p-4 relative">
                            <img id="onizlemeResim"
                                class="hidden max-w-full max-h-full object-contain shadow-lg rounded" alt="Önizleme">
                            <iframe id="onizlemeFrame" class="hidden w-full h-full bg-white rounded shadow-lg"></iframe>
                            <div id="onizlemeHtml"
                                class="hidden w-full h-full bg-white overflow-y-auto p-8 rounded shadow-lg text-left text-slate-900">
                            </div>
                            <div id="onizlemeDesteklenmiyor" class="hidden text-center text-gray-400">
                                <i data-lucide="file-warning" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>Bu dosya formatı için önizleme desteklenmiyor.</p>
                            </div>
                            <div id="onizlemeYukleniyor"
                                class="hidden absolute inset-0 flex items-center justify-center bg-gray-900/50 rounded z-10">
                                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-white"></div>
                            </div>
                            <i data-lucide="file-warning" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                            <p>Bu dosya formatı için önizleme desteklenmiyor.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 5: HAZIRLANAN SINAVLAR -->
    <div id="content-sinavlar" class="tab-content hidden animate-fade-in">
        <div class="max-w-4xl mx-auto py-4">
            <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-5 mb-8 flex items-center gap-4 shadow-sm">
                <div class="w-12 h-12 bg-indigo-600 text-white rounded-xl flex items-center justify-center shadow-lg">
                    <i data-lucide="award" class="w-6 h-6"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-bold text-indigo-900 text-lg">Hazırlanan Sınavlar</h3>
                    <p class="text-sm text-indigo-600/80">Sistemde kayıtlı tüm sınavları buradan yönetebilirsiniz.</p>
                </div>
                <button onclick="tumSinavlariSil()"
                    class="px-4 py-2 bg-red-600 text-white rounded-xl text-xs font-black hover:bg-red-700 transition-all flex items-center gap-2 shadow-lg shadow-red-100">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                    TÜMÜNÜ SİL
                </button>
            </div>

            <div class="space-y-4">
                {% for sinav in sinavlar %}
                <div
                    class="bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-all group/card border-l-4 border-l-indigo-500">
                    <details class="group">
                        <summary
                            class="flex items-center justify-between p-5 cursor-pointer hover:bg-slate-50 transition-colors list-none">
                            <div class="flex items-center gap-5">
                                <div
                                    class="w-12 h-12 bg-slate-100 text-slate-500 rounded-xl flex items-center justify-center font-black text-lg group-hover:bg-indigo-100 group-hover:text-indigo-600 transition-colors">
                                    {{ loop.index }}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3
                                        class="font-bold text-slate-800 text-lg truncate group-hover:text-indigo-600 transition-colors">
                                        {{ sinav.baslik }}</h3>
                                    <div class="flex flex-wrap items-center gap-4 mt-2">
                                        <span
                                            class="flex items-center gap-1.5 text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-md">
                                            <i data-lucide="calendar" class="w-3.5 h-3.5"></i>
                                            {% if sinav.olusturma_tarihi %}
                                            {{ sinav.olusturma_tarihi.strftime('%d.%m.%Y %H:%M') }}
                                            {% else %}
                                            Bilinmiyor
                                            {% endif %}
                                        </span>
                                        <span
                                            class="flex items-center gap-1.5 text-xs font-medium text-slate-600 bg-indigo-50 px-2 py-1 rounded-md border border-indigo-100">
                                            <i data-lucide="help-circle" class="w-3.5 h-3.5"></i>
                                            {{ sinav.sorular|length }} Soru
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button
                                    onclick="event.stopPropagation(); event.preventDefault(); sinavSil({{ sinav.id }})"
                                    class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all"
                                    title="Hızlı Sil">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                                <div class="p-2 rounded-full hover:bg-slate-200 transition-all">
                                    <i data-lucide="chevron-down"
                                        class="w-6 h-6 text-slate-400 group-open:rotate-180 transition-transform"></i>
                                </div>
                            </div>
                        </summary>
                        <div class="p-6 border-t border-slate-100 bg-slate-50/30">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-6">
                                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i data-lucide="school" class="w-3.5 h-3.5 text-slate-400"></i>
                                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Kurum
                                            / Okul Bilgisi</p>
                                    </div>
                                    <p class="text-sm text-slate-700 font-bold">{{ sinav.okul_adi or '-' }}</p>
                                </div>
                                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i data-lucide="graduation-cap" class="w-3.5 h-3.5 text-slate-400"></i>
                                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Eğitim
                                            Yılı & Dönem</p>
                                    </div>
                                    <p class="text-sm text-slate-700 font-bold">{{ sinav.egitim_yili or '-' }} / {{
                                        sinav.donem or '-' }}</p>
                                </div>
                                {% if sinav.aciklama %}
                                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm col-span-full">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i data-lucide="info" class="w-3.5 h-3.5 text-slate-400"></i>
                                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Sınav
                                            Açıklaması / Notlar</p>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed">{{ sinav.aciklama }}</p>
                                </div>
                                {% endif %}
                            </div>
                            <div class="flex items-center justify-end gap-3 pt-5 border-t border-slate-200">
                                <a href="/sinav-onizleme/{{ sinav.id }}" target="_blank"
                                    class="px-6 py-2.5 bg-indigo-600 text-white rounded-xl text-xs font-black hover:bg-indigo-700 transition-all flex items-center gap-2 shadow-md shadow-indigo-200">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                    SINAV ÖNİZLEME
                                </a>
                                <button onclick="sinavSil({{ sinav.id }})"
                                    class="px-6 py-2.5 bg-white border border-red-200 text-red-600 rounded-xl text-xs font-black hover:bg-red-50 transition-all flex items-center gap-2">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    SİSTEMDEN SİL
                                </button>
                            </div>
                        </div>
                    </details>
                </div>
                {% else %}
                <div class="text-center py-20 bg-white border-2 border-dashed border-slate-200 rounded-3xl">
                    <div
                        class="w-24 h-24 bg-slate-50 text-slate-300 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="award" class="w-12 h-12"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800">Henüz bir sınav hazırlanmamış</h3>
                    <p class="text-slate-500 mt-2 max-w-sm mx-auto">Sınav hazırlama modülünü kullanarak ilk sınavınızı
                        hemen oluşturabilirsiniz.</p>
                    <a href="/"
                        class="inline-flex items-center gap-2 mt-8 px-8 py-3 bg-indigo-600 text-white rounded-2xl font-bold transition-all hover:bg-indigo-700 shadow-lg shadow-indigo-100">
                        Yeni Sınav Hazırla <i data-lucide="plus" class="w-5 h-5"></i>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- TAB 4: TARİFLER -->
    <div id="content-tarif" class="tab-content hidden animate-fade-in">
        <div class="max-w-4xl mx-auto py-4">
            <!-- Madde 1: Sayaç Sıfırlama -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <details class="group">
                    <summary
                        class="flex items-center justify-between p-4 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-purple-100 text-purple-600 rounded-lg">
                                <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800">Sayaçları Sıfırlama Özelliği</h3>
                                <p class="text-xs text-slate-500">Son Eklenen Özellik</p>
                            </div>
                        </div>
                        <i data-lucide="chevron-down"
                            class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-4 border-t border-slate-200 bg-white">
                        <div class="mb-4">
                            <h4 class="text-sm font-bold text-slate-900 mb-1">Kullanıcı Promptu:</h4>
                            <div
                                class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm text-gray-700 font-mono">
                                "Ayarlar sayfasına projede tutulan tüm sayaçları sıfırlama özelliği ekle..."
                            </div>
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-indigo-900 mb-1">Teknik Uygulama:</h4>
                            <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                                <li>Backend ve Frontend entegrasyonu ile <code>sqlite_sequence</code> tablosu
                                    yönetimi.</li>
                            </ul>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Madde 2: Sidebar Düzenlemesi -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <details class="group">
                    <summary
                        class="flex items-center justify-between p-4 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-100 text-blue-600 rounded-lg">
                                <i data-lucide="panel-left" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800">Sidebar Buton Konumu ve İkonu</h3>
                            </div>
                        </div>
                        <i data-lucide="chevron-down"
                            class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-4 border-t border-slate-200 bg-white">
                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                            <li>Buton sidebar'a bitişik hale getirildi, ikonlar dinamikleştirildi.</li>
                        </ul>
                    </div>
                </details>
            </div>

            <!-- Madde 3: Font Boyutları -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <details class="group">
                    <summary
                        class="flex items-center justify-between p-4 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-green-100 text-green-600 rounded-lg"><i data-lucide="type"
                                    class="w-5 h-5"></i></div>
                            <div>
                                <h3 class="font-bold text-slate-800">Başlık ve Eğitim Yılı Font Boyutları</h3>
                            </div>
                        </div>
                        <i data-lucide="chevron-down"
                            class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-4 border-t border-slate-200 bg-white">
                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                            <li>Veritabanı ve UI güncellenerek font boyutu (px) ayarı eklendi.</li>
                        </ul>
                    </div>
                </details>
            </div>

            <!-- Madde 4: Panel Düzeni -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <details class="group">
                    <summary
                        class="flex items-center justify-between p-4 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-orange-100 text-orange-600 rounded-lg"><i data-lucide="layout-template"
                                    class="w-5 h-5"></i></div>
                            <div>
                                <h3 class="font-bold text-slate-800">Sınav Bilgileri Panel Düzeni</h3>
                            </div>
                        </div>
                        <i data-lucide="chevron-down"
                            class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-4 border-t border-slate-200 bg-white">
                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                            <li>Grid yapısı düzenlendi, antet bilgileri sıralandı.</li>
                        </ul>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <!-- TAB 6: JSON VERİ MERKEZİ -->
    <div id="content-json" class="tab-content hidden animate-fade-in bg-white rounded-xl shadow-lg p-6">
        <div class="flex flex-col h-[600px]">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div>
                        <h3 class="text-xl font-bold text-gray-900">Soru Bankası JSON Verisi</h3>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span class="flex h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            <p class="text-[10px] text-gray-500 font-medium uppercase tracking-wider">Canlı Veri
                                Senkronizasyonu Aktif</p>
                        </div>
                    </div>
                    <button onclick="soruJsonYukle()" title="Veriyi Yenile"
                        class="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all active:rotate-180 duration-500">
                        <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex items-center gap-3">
                    <span id="jsonZaman" class="text-[11px] font-mono text-slate-400"></span>
                    <button onclick="jsonIndir()"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg transition-all active:scale-95">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        JSON Olarak İndir
                    </button>
                </div>
            </div>
            <div class="flex-1 bg-gray-900 rounded-xl overflow-hidden relative">
                <div id="jsonYukleniyor"
                    class="absolute inset-0 flex items-center justify-center bg-gray-900/50 z-10 hidden">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-white"></div>
                </div>
                <pre
                    class="w-full h-full p-6 overflow-auto text-xs font-mono text-green-400 bg-gray-900 scrollbar-thin scrollbar-thumb-gray-700"><code id="jsonKodAlani">// Veriler yükleniyor...</code></pre>
            </div>
        </div>
    </div>
</div>
</div>

<script>
    let activeTab = 'imza';

    // Tab Değiştirme
    function tabDegistir(tabId) {
        activeTab = tabId;
        // İçerikleri temizle
        document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
        document.getElementById('content-' + tabId).classList.remove('hidden');

        // Buton stillerini sıfırla
        document.querySelectorAll('.tab-btn').forEach(el => {
            el.classList.remove('border-indigo-500', 'text-indigo-600', 'bg-indigo-50');
            el.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        });

        // Aktif buton stili
        const btn = document.getElementById('tab-' + tabId);
        btn.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        btn.classList.add('border-indigo-500', 'text-indigo-600', 'bg-indigo-50');

        // LocalStorage'a kaydet (Sayfa yenilenince hatırla)
        localStorage.setItem('aktifAyarTab', tabId);

        // JSON Tabı ise veriyi çek
        if (tabId === 'json') {
            soruJsonYukle();
        }
    }

    // Sayfa Yüklendiğinde
    document.addEventListener('DOMContentLoaded', () => {
        const sonTab = localStorage.getItem('aktifAyarTab') || 'imza';
        tabDegistir(sonTab);

        // Lucide
        lucide.createIcons();
        onizlemeGuncelle();
    });

    // İMZA JS
    const imzaMetni = document.getElementById('imzaMetni');
    const cizgiRengi = document.getElementById('cizgiRengi');
    const cizgiKalinlik = document.getElementById('cizgiKalinlik');
    const metinBoyutu = document.getElementById('metinBoyutu');

    const onizlemeMetin = document.getElementById('onizlemeMetin');
    const onizlemeCizgi = document.getElementById('onizlemeCizgi');

    function onizlemeGuncelle() {
        if (!imzaMetni) return;
        onizlemeMetin.textContent = imzaMetni.value || 'Öğr.Gör.Erdem ALPAR';
        onizlemeCizgi.style.borderColor = cizgiRengi.value;
        onizlemeCizgi.style.borderWidth = cizgiKalinlik.value + 'px';
        onizlemeMetin.style.fontSize = metinBoyutu.value + 'pt';
    }

    if (imzaMetni) {
        imzaMetni.addEventListener('input', onizlemeGuncelle);
        cizgiRengi.addEventListener('input', onizlemeGuncelle);
        cizgiKalinlik.addEventListener('input', onizlemeGuncelle);
        metinBoyutu.addEventListener('input', onizlemeGuncelle);
    }

    document.getElementById('ayarForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const ayarlar = {
            imza_metni: imzaMetni.value,
            cizgi_rengi: cizgiRengi.value,
            cizgi_kalinlik: parseFloat(cizgiKalinlik.value),
            metin_boyutu: parseInt(metinBoyutu.value)
        };

        try {
            const data = await apiIstegi('/ayarlar-kaydet', {
                method: 'POST', body: JSON.stringify(ayarlar)
            });
            toastGoster('Ayarlar başarıyla kaydedildi!', 'success');
        } catch (error) {
            console.error(error);
        }
    });

    function sifirla() {
        imzaMetni.value = 'Öğr.Gör.Erdem ALPAR';
        cizgiRengi.value = '#CCCCCC';
        cizgiKalinlik.value = '1';
        metinBoyutu.value = '12';
        document.getElementById('kalinlikDeger').textContent = '1px';
        document.getElementById('boyutDeger').textContent = '12pt';
        onizlemeGuncelle();
        toastGoster('Ayarlar varsayılana döndürüldü', 'info');
    }

    // SAYAÇ JS
    async function sayacSifirla(tablo) {
        if (!confirm('DİKKAT! Bu işlem sayaçları sıfırlayacaktır. İlgili tablolardaki verilerin silindiğinden emin olun. Devam?')) {
            return;
        }

        try {
            const data = await apiIstegi('/api/sayac-sifirla', {
                method: 'POST', body: JSON.stringify({ tablo: tablo })
            });
            toastGoster(data.mesaj, 'success');
        } catch (error) {
            console.error('Hata:', error);
            // toastGoster apiIstegi icinde
        }
    }
    // DOSYA YÖNETİCİSİ JS
    async function dosyaGoster(ad, uzanti) {
        const placeholder = document.getElementById('onizlemePlaceholder');
        const icerik = document.getElementById('onizlemeIcerik');
        const resim = document.getElementById('onizlemeResim');
        const frame = document.getElementById('onizlemeFrame');
        const onizlemeHtml = document.getElementById('onizlemeHtml');
        const desteklenmiyor = document.getElementById('onizlemeDesteklenmiyor');
        const yukleniyor = document.getElementById('onizlemeYukleniyor');
        const aktifAd = document.getElementById('aktifDosyaAdi');
        const link = document.getElementById('indirmeLinki');

        const dosyaYolu = `/static/yuklemeler/${ad}`;

        // Reset
        placeholder.style.display = 'none';
        icerik.classList.remove('hidden');
        resim.classList.add('hidden');
        frame.classList.add('hidden');
        onizlemeHtml.classList.add('hidden');
        desteklenmiyor.classList.add('hidden');

        aktifAd.textContent = ad;
        link.href = dosyaYolu;

        if (['png', 'jpg', 'jpeg', 'gif', 'webp'].includes(uzanti)) {
            resim.src = dosyaYolu;
            resim.classList.remove('hidden');
        } else if (['pdf', 'txt'].includes(uzanti)) {
            frame.src = dosyaYolu;
            frame.classList.remove('hidden');
        } else if (uzanti === 'json') {
            yukleniyor.classList.remove('hidden');
            try {
                const response = await fetch(dosyaYolu);
                const data = await response.json();
                onizlemeHtml.innerHTML = `<pre class="text-xs p-4 bg-slate-50 border rounded-lg overflow-auto max-h-full w-full"><code>${JSON.stringify(data, null, 2)}</code></pre>`;
                onizlemeHtml.classList.remove('hidden');
            } catch (error) {
                console.error('JSON okuma hatası:', error);
                onizlemeHtml.innerHTML = '<p class="text-red-500 p-4">JSON dosyası okunurken bir hata oluştu.</p>';
                onizlemeHtml.classList.remove('hidden');
            } finally {
                yukleniyor.classList.add('hidden');
            }
        } else {
            desteklenmiyor.classList.remove('hidden');
        }
    }

    // SINAV LİSTESİ JS
    async function sinavSil(sinavId) {
        if (!confirm('Bu sınavı silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.')) return;

        try {
            const data = await apiIstegi(`/sinav-sil/${sinavId}`, { method: 'DELETE' });
            toastGoster('Sınav başarıyla silindi', 'success');
            setTimeout(() => location.reload(), 1000);
        } catch (error) {
            console.error('Silme hatası:', error);
        }
    }

    async function tumSinavlariSil() {
        if (!confirm('DİKKAT! Tüm hazırlanan sınavlar sistemden kalıcı olarak silinecektir. Bu işlem geri alınamaz. Emin misiniz?')) {
            return;
        }

        try {
            const data = await apiIstegi('/api/tum-sinavlari-sil', { method: 'POST' });
            toastGoster('Tüm sınavlar başarıyla temizlendi', 'success');
            setTimeout(() => location.reload(), 1000);
        } catch (error) {
            console.error('Toplu silme hatası:', error);
        }
    }

    // JSON İŞLEMLERİ
    let mevcutJsonData = null;

    async function soruJsonYukle() {
        const kodAlani = document.getElementById('jsonKodAlani');
        const yukleniyor = document.getElementById('jsonYukleniyor');
        const zamanEtiketi = document.getElementById('jsonZaman');

        yukleniyor.classList.remove('hidden');
        try {
            const data = await apiIstegi('/api/sorular-json');
            mevcutJsonData = data;
            kodAlani.textContent = JSON.stringify(data, null, 2);

            // Son güncelleme zamanını yaz
            const simdi = new Date();
            zamanEtiketi.textContent = `Son Senkronizasyon: ${simdi.getHours().toString().padStart(2, '0')}:${simdi.getMinutes().toString().padStart(2, '0')}:${simdi.getSeconds().toString().padStart(2, '0')}`;

            if (activeTab === 'json') {
                toastGoster('Soru bankası verileri güncellendi', 'success');
            }
        } catch (error) {
            kodAlani.textContent = '// Veriler alınırken hata oluştu: ' + error.message;
        } finally {
            yukleniyor.classList.add('hidden');
        }
    }

    function jsonIndir() {
        if (!mevcutJsonData) {
            toastGoster('İndirilecek veri bulunamadı', 'warning');
            return;
        }

        const blob = new Blob([JSON.stringify(mevcutJsonData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `soru_bankasi_yedek_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        toastGoster('JSON dosyası indiriliyor...', 'info');
    }
</script>
{% endblock %}